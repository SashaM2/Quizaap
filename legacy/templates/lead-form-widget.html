<!-- This file provides an embeddable lead form widget for quiz pages -->
<!-- Include this after the tracking script on your quiz page -->

<div id="quiz-lead-form-widget" style="display: none; position: fixed; bottom: 20px; right: 20px; background: white; border-radius: 8px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2); padding: 20px; width: 100%; max-width: 350px; z-index: 9999; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <h3 style="margin: 0; color: #1e40af; font-size: 18px;">Get Your Results</h3>
        <button onclick="closeLeadForm()" style="background: none; border: none; font-size: 24px; color: #999; cursor: pointer;">&times;</button>
    </div>
    
    <form id="lead-form-inline" style="display: flex; flex-direction: column; gap: 10px;">
        <input type="text" name="name" placeholder="Your Name" required style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
        <input type="email" name="email" placeholder="Your Email" required style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
        <input type="tel" name="phone" placeholder="Phone (optional)" style="padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
        <button type="submit" style="padding: 10px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border: none; border-radius: 4px; font-weight: 600; cursor: pointer; font-size: 14px;">Get Results</button>
    </form>
    
    <div id="form-message" style="display: none; margin-top: 10px; padding: 10px; border-radius: 4px; text-align: center; font-size: 14px;"></div>
</div>

<script>
    window.showLeadForm = function(quizResult = null) {
        const widget = document.getElementById('quiz-lead-form-widget');
        if (widget) {
            widget.style.display = 'block';
            window.currentQuizResult = quizResult;
        }
    };
    
    window.closeLeadForm = function() {
        const widget = document.getElementById('quiz-lead-form-widget');
        if (widget) {
            widget.style.display = 'none';
        }
    };
    
    document.getElementById('lead-form-inline').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const name = document.querySelector('input[name="name"]').value;
        const email = document.querySelector('input[name="email"]').value;
        const phone = document.querySelector('input[name="phone"]').value;
        
        try {
            const response = await fetch('/api/lead', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    session_id: window.SESSION_ID || '',
                    quiz_id: window.QUIZ_ID || '',
                    name,
                    email,
                    phone,
                    quiz_result: window.currentQuizResult || null
                })
            });
            
            if (response.ok) {
                const message = document.getElementById('form-message');
                message.style.display = 'block';
                message.style.background = '#d1fae5';
                message.style.color = '#065f46';
                message.textContent = 'Thank you! Your lead has been submitted.';
                
                setTimeout(() => {
                    window.closeLeadForm();
                    document.getElementById('lead-form-inline').reset();
                    message.style.display = 'none';
                }, 2000);
            }
        } catch (error) {
            console.error('Error submitting lead:', error);
            const message = document.getElementById('form-message');
            message.style.display = 'block';
            message.style.background = '#fee2e2';
            message.style.color = '#991b1b';
            message.textContent = 'Error submitting form. Please try again.';
        }
    });
</script>
